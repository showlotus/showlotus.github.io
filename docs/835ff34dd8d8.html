<!DOCTYPE html><html class="appearance-light" lang="zh-CN"><head><meta charset="UTF-8"><title>ç«æ€å‡½æ•°è¿‡æœŸ</title><meta name="description" content="I hope one day, everyone is using my program."><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç‚¹å‡»ä¸åŒçš„ Tab é¡µç­¾ï¼ŒTable ä¸­å±•ç¤ºä¸åŒçš„æ•°æ®ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é¡µé¢äº¤äº’é€»è¾‘ã€‚
è®¾æƒ³ä¸€ä¸‹ï¼Œå½“å‰çš„å¤„ç†é€»è¾‘æ˜¯ï¼šæœ‰ä¸‰ä¸ª Tab é¡µç­¾å’Œä¸€ä¸ª Tableï¼Œæ¯ç‚¹å‡» Tab åï¼Œéƒ½ä¼šå‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åè¯·æ±‚æˆåŠŸåï¼Œä¼šå¯¹ Table é‡æ–°èµ‹å€¼ã€‚ä¹Ÿå³ï¼Œä¸åŒçš„ Tab åˆ‡æ¢ï¼Œéƒ½ä¼šå¯¹è¿™ä¸ªå”¯ä¸€çš„ Table è¿›è¡Œé‡æ–°èµ‹å€¼ã€‚

ä»”ç»†æƒ³ä¸€ä¸‹ï¼Œè¿™ä¼šæœ‰é—®é¢˜å—ï¼Ÿ
æœ‰çš„ï¼Œè¿™é‡Œéšè—ç€ä¸€ä¸ª â€œç«æ€â€ é—®é¢˜ã€‚å½“ç‚¹å‡» Tab é¡µç­¾çš„æ“ä½œè¿‡äºé¢‘ç¹æ—¶ï¼Œèƒ½ä¿è¯å½“å‰ Table é‡Œå±•ç¤ºçš„æ•°æ®æ˜¯æœ€åä¸€æ¬¡ç‚¹å‡»çš„ Tab å¯¹åº”çš„æ•°æ®å—ï¼Ÿ

ä¸€é¡¿æ“ä½œä¹‹åï¼ŒTable çš„æ•°æ®ç©¶ç«Ÿæ¥è‡ªå“ªä¸ª Tab é¡µç­¾ï¼Œä¼°è®¡æ²¡ä¸€ä¸ªäººèƒ½è¯´çš„æ¸…æ¥šã€‚å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå…ˆæ¥åˆ†æä¸€ä¸‹é—®é¢˜å‡ºç°çš„åŸå› ã€‚

é¦–å…ˆï¼Œå› ä¸ºå‘èµ·è¯·æ±‚æ˜¯å¼‚æ­¥ï¼Œä¸èƒ½ä¿è¯è¯·æ±‚ä¸€å®šæ˜¯æŒ‰ç…§è§¦å‘çš„é¡ºåºä¾æ¬¡è¿”å›å¯¹.."><meta name="generator" content="Hexo 5.4.2"></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">showlotus's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">ç«æ€å‡½æ•°è¿‡æœŸ</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">ç‚¹å‡»è¿”å›é¡¶éƒ¨</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile is-hidden"></div><div class="column is-9"><header class="my-4"><a href="/tags/JavaScript"><i class="tag post-item-tag">JavaScript</i></a><a href="/tags/%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0"><i class="tag post-item-tag">å·¥å…·å‡½æ•°</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">ç«æ€å‡½æ•°è¿‡æœŸ</h1><time class="has-text-grey custom-date-font" datetime="2024-06-01T15:12:11.000Z">2024/06/01 15:12</time><article class="mt-2 post-content"><p><img src="/835ff34dd8d8/intro.excalidraw.png" alt="intro.png"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç‚¹å‡»ä¸åŒçš„ <code>Tab</code> é¡µç­¾ï¼Œ<code>Table</code> ä¸­å±•ç¤ºä¸åŒçš„æ•°æ®ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é¡µé¢äº¤äº’é€»è¾‘ã€‚</p>
<p>è®¾æƒ³ä¸€ä¸‹ï¼Œå½“å‰çš„å¤„ç†é€»è¾‘æ˜¯ï¼šæœ‰ä¸‰ä¸ª <code>Tab</code> é¡µç­¾å’Œä¸€ä¸ª <code>Table</code>ï¼Œæ¯ç‚¹å‡» <code>Tab</code> åï¼Œéƒ½ä¼šå‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åè¯·æ±‚æˆåŠŸåï¼Œä¼šå¯¹ <code>Table</code> é‡æ–°èµ‹å€¼ã€‚ä¹Ÿå³ï¼Œä¸åŒçš„ <code>Tab</code> åˆ‡æ¢ï¼Œéƒ½ä¼šå¯¹è¿™ä¸ªå”¯ä¸€çš„ <code>Table</code> è¿›è¡Œé‡æ–°èµ‹å€¼ã€‚</p>
<p><img src="/835ff34dd8d8/update.excalidraw.png" alt="update.png"></p>
<p>ä»”ç»†æƒ³ä¸€ä¸‹ï¼Œè¿™ä¼šæœ‰é—®é¢˜å—ï¼Ÿ</p>
<p>æœ‰çš„ï¼Œè¿™é‡Œéšè—ç€ä¸€ä¸ª â€œç«æ€â€ é—®é¢˜ã€‚å½“ç‚¹å‡» <code>Tab</code> é¡µç­¾çš„æ“ä½œè¿‡äºé¢‘ç¹æ—¶ï¼Œèƒ½ä¿è¯å½“å‰ <code>Table</code> é‡Œå±•ç¤ºçš„æ•°æ®æ˜¯æœ€åä¸€æ¬¡ç‚¹å‡»çš„ <code>Tab</code> å¯¹åº”çš„æ•°æ®å—ï¼Ÿ</p>
<p><img src="/835ff34dd8d8/update-unclear.excalidraw.png" alt="update-unclear.png"></p>
<p>ä¸€é¡¿æ“ä½œä¹‹åï¼Œ<code>Table</code> çš„æ•°æ®ç©¶ç«Ÿæ¥è‡ªå“ªä¸ª <code>Tab</code> é¡µç­¾ï¼Œä¼°è®¡æ²¡ä¸€ä¸ªäººèƒ½è¯´çš„æ¸…æ¥šã€‚å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå…ˆæ¥åˆ†æä¸€ä¸‹é—®é¢˜å‡ºç°çš„åŸå› ã€‚</p>
<ul>
<li>é¦–å…ˆï¼Œå› ä¸ºå‘èµ·è¯·æ±‚æ˜¯å¼‚æ­¥ï¼Œä¸èƒ½ä¿è¯è¯·æ±‚ä¸€å®šæ˜¯æŒ‰ç…§è§¦å‘çš„é¡ºåºä¾æ¬¡è¿”å›å¯¹åº”çš„ç»“æœï¼Œä»è€Œå¯¼è‡´äº†æ•°æ®çš„ä¸ç¡®å®šæ€§ï¼›</li>
<li>å…¶æ¬¡ï¼Œæ¯æ¬¡å‘èµ·æ–°è¯·æ±‚åï¼Œä¹‹å‰çš„å†å²è¯·æ±‚éƒ½å·²ç» â€œè¿‡æœŸâ€ äº†ï¼Œä¸åº”è¯¥å†ç”¨å†å²è¯·æ±‚è·å–åˆ°çš„æ•°æ®å»æ›´æ–°è¡¨æ ¼ï¼Œè¿™æ˜¯å†å²è¯·æ±‚æ‰€å¸¦æ¥çš„ â€œå‰¯ä½œç”¨â€ã€‚</li>
</ul>
<p>è§£å†³é—®é¢˜çš„å…³é”®å°±æ˜¯å¦‚ä½•æ¶ˆé™¤è¿™ç§ â€œå‰¯ä½œç”¨â€ï¼š<em>æ€ä¹ˆè®©å†å²è¯·æ±‚ä¸å†æ›´æ–° <code>Table</code> ä¸­çš„æ•°æ®</em> ã€‚</p>
<blockquote>
<p>è§„é¿è¿™ä¸€é—®é¢˜è¿˜æœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•ï¼šæ‹†åˆ†æ•°æ®ã€‚å°±æ˜¯å®šä¹‰ 3 ä¸ªå˜é‡åˆ†åˆ«ç”¨æ¥è®°å½•ä¸åŒé¡µç­¾è¿”å›çš„æ•°æ®ï¼Œæ ¹æ®å½“å‰ç‚¹å‡»çš„ <code>Tab</code> å±•ç¤ºå¯¹åº”çš„æ•°æ®ã€‚è€Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œæ˜¯é‡‡ç”¨æ‹†åˆ†æ•°æ®ï¼Œè¿˜æ˜¯å…±ç”¨åŒä¸€ä»½æ•°æ®ï¼Œéœ€è¦ä¾æ®å…·ä½“åœºæ™¯å…·ä½“åˆ†æã€‚åœ¨è¿™é‡Œï¼Œé‡‡ç”¨å…±ç”¨åŒä¸€ä»½æ•°æ®çš„æ–¹å¼ï¼Œä½œä¸ºè§£å†³ç«æ€é—®é¢˜çš„å‰æï¼Œå…¶ä»–æš‚ä¸è€ƒè™‘ã€‚</p>
</blockquote>
<p>æŒ‰ç…§è¿™ä¸ªè§£å†³æ€è·¯ï¼Œæ¯å½“æœ‰æ–°è¯·æ±‚å‘èµ·æ—¶ï¼Œå°±ç»™å†å²è¯·æ±‚æ‰“ä¸Š â€œè¿‡æœŸâ€ çš„æ ‡è®°ï¼Œç­‰å½“å‰è¯·æ±‚æˆåŠŸååˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œåªæœ‰æœªè¿‡æœŸçš„è¯·æ±‚æ‰å»æ›´æ–° <code>Table</code>ã€‚é‚£ä¹ˆå¦‚ä½•å°†ä¸€ä¸ªå†å²è¯·æ±‚æ ‡è®°ä¸º â€œè¿‡æœŸâ€ å‘¢ï¼Ÿä¸å¦¨å€Ÿé‰´ä¸€ä¸‹ <em>Vue</em> ä¸­ <code>onCleanup</code> çš„åŸç†æ¥å®ç°ã€‚</p>
<p><em>Vue3</em> ä¸­ <code>watch</code> æ–¹æ³•çš„å›è°ƒå‡½æ•° <code>WatchCallback</code>ï¼Œç›¸è¾ƒäºä»¥å¾€çš„ <code>newValue</code> å’Œ <code>oldValue</code>ï¼Œæ–°å¢äº†ä¸€ä¸ªå‚æ•° <code>onCleanup</code>ï¼Œç”¨ä»¥æ¸…ç†è¿‡æœŸçš„å›è°ƒå‡½æ•°ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/vuejs/core/blob/cf8cd1d97ec1de139a68ba9adfb207625cd2fe2d/packages/runtime-core/src/apiWatch.ts#L358">ğŸ‘‰ æºç åœ°å€</a>ã€‚æ¯æ¬¡ <code>WatchCallback</code> æ‰§è¡Œæ—¶ï¼Œéƒ½ä¼šå…ˆæ‰§è¡Œ <code>onCleanup</code> é‡Œçš„å›è°ƒå‡½æ•°ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<details open>
<summary>js</summary>

<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">watch</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">,</span> onCleanup</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ç”¨ä¸€ä¸ªæ ‡è¯†è®°å½•å½“å‰å›è°ƒæ˜¯å¦è¿‡æœŸ</span>
  <span class="token keyword">let</span> expired <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token comment">// cleanup æ‰§è¡Œæ—¶ï¼Œå°†æ ‡è¯†ç½®ä¸º true</span>
  <span class="token function">onCleanup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    expired <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/xxx/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token comment">// åˆ¤æ–­å½“å‰å›è°ƒæ˜¯å¦è¿‡æœŸï¼Œæœªè¿‡æœŸæ‰ä¼šæ‰“å° data</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>expired<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

</details>

<p>ä¸Šè¿°ä»£ç æ˜¯å¦‚ä½•è¿ä½œçš„ï¼š</p>
<ul>
<li><code>watch</code> å†…éƒ¨æ‰§è¡Œ <code>WatchCallback</code> æ—¶ä¼šå…ˆåˆ¤æ–­æ˜¯å¦æœ‰ <code>cleanup</code>ï¼Œè‹¥æœ‰åˆ™æ‰§è¡Œï¼Œéšåå†æ‰§è¡Œ <code>WatchCallback</code> å†…éƒ¨çš„é€»è¾‘ã€‚é¦–æ¬¡æ‰§è¡Œ <code>WatchCallback</code> æ—¶ï¼Œ<code>cleanup</code> ä¸ºç©ºï¼›</li>
<li>æ¯æ¬¡ <code>WatchCallback</code> æ‰§è¡Œæ—¶ï¼Œéƒ½ä¼šåœ¨å†…éƒ¨å®šä¹‰ä¸€ä¸ª <code>expired</code> å˜é‡ï¼ŒåŒæ—¶å‘ <code>onCleanup</code> æ³¨å†Œä¸€ä¸ªå›è°ƒ <code>cleanup</code>ï¼Œç”¨ä»¥å°† <code>expired</code> èµ‹å€¼ä¸º <code>false</code>ï¼›</li>
<li>å½“æœ¬è½® <code>WatchCallback</code> è¿˜æœªæ‰§è¡Œå®Œæ¯•ï¼Œåˆè§¦å‘æ–°ä¸€è½®çš„ <code>WatchCallback</code> æ—¶ï¼Œæ­¤æ—¶ï¼Œ<code>cleanup</code> æœ‰å€¼ï¼Œæ‰§è¡Œ <code>cleanup</code> åï¼Œä¼šå°†ä¸Šä¸€è½® <code>WatchCallback</code> ä¸­çš„ <code>expired</code> ç½®ä¸º <code>false</code>ï¼›</li>
<li>å½“ä¸Šä¸€è½®çš„ <code>WatchCallback</code> ä¸­çš„ <code>fetch</code> æ‰§è¡Œå®Œåï¼Œæ­¤æ—¶ <code>expired</code> å·²è¢«ç½®ä¸º <code>false</code>ï¼Œå› æ­¤ä¸ä¼šæ‰“å° <code>data</code>ï¼›</li>
<li>è€Œå½“æœ€æ–°çš„ <code>WatchCallback</code> ä¸­çš„ <code>fetch</code> æ‰§è¡Œå®Œåï¼Œæ­¤æ—¶ <code>expired</code> è¿˜æ˜¯ <code>true</code>ï¼Œå› æ­¤ä¼šæ‰“å° <code>data</code>ã€‚</li>
</ul>
<p>æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œå…ˆæ¥å®ç°ä¸€ä¸ªç›‘å¬æ™®é€šå›è°ƒå‡½æ•°çš„ç‰ˆæœ¬ï¼š</p>
<details open>
<summary>js</summary>

<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/**
 * ç›‘å¬å›è°ƒå‡½æ•°æ˜¯å¦è¿‡æœŸ
 * @param &#123;(args: Array&lt;any>, onCleanup: () => void) => any&#125; callback
 * @return &#123;(...args: Array&lt;any>) => ReturnType&lt;callback>&#125;
 */</span>
<span class="token keyword">function</span> <span class="token function">watchExpiredCallback</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> cleanup
  <span class="token keyword">const</span> <span class="token function-variable function">onCleanup</span> <span class="token operator">=</span> <span class="token parameter">fn</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    cleanup <span class="token operator">=</span> fn
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    cleanup<span class="token operator">?.</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// åŸå‡½æ•°çš„å…¥å‚ï¼Œé€šè¿‡ args é€ä¼ è¿›å»</span>
    <span class="token comment">// æ–°å¢å…¥å‚ onCleanup</span>
    <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>args<span class="token punctuation">,</span> onCleanup<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

</details>

<p>ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<details open>
<summary>js</summary>

<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// åŸæœ¬çš„å¼‚æ­¥å‡½æ•°</span>
<span class="token keyword">const</span> <span class="token function-variable function">request</span> <span class="token operator">=</span> <span class="token parameter">id</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// å¯ç›‘å¬æ˜¯å¦è¿‡æœŸçš„å¼‚æ­¥å‡½æ•°</span>
<span class="token keyword">const</span> newRequest <span class="token operator">=</span> <span class="token function">watchExpiredCallback</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> onCleanup</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> expired <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token function">onCleanup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    expired <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> id <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>expired<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> data
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">"request expired"</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token function">newRequest</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token function">newRequest</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token function">newRequest</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

</details>

<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="/835ff34dd8d8/code-v1.png" alt="code-v1"></p>
<p>è¿ç»­è°ƒç”¨äº†ä¸‰æ¬¡ <code>newRequest</code>ï¼Œåªæœ‰æœ€åä¸€æ¬¡æ‰“å°äº†ç»“æœï¼Œå‰ä¸¤æ¬¡éƒ½å½“ä½œ â€œè¿‡æœŸâ€ å¤„ç†ã€‚ç«æ€é—®é¢˜å°±è¿™æ ·è½»æ¾è§£å†³å•¦ï½</p>
<p>ä½†æ˜¯å‘¢ï¼Œç°åœ¨è¿™è¿˜ä¸å¤Ÿå¥½ï¼Œå‰ä¸¤æ¬¡è¯·æ±‚å·²ç»è¿‡æœŸäº†ï¼Œå¯è¿˜æ˜¯å‘èµ·è¯·æ±‚å¹¶è·å–äº†å“åº”ç»“æœï¼Œæœ‰ç‚¹æµªè´¹èµ„æºï¼Œåº”è¯¥æŠŠè¿‡æœŸçš„è¯·æ±‚éƒ½å–æ¶ˆæ‰æ‰åˆç†ã€‚è€Œå–æ¶ˆè¯·æ±‚å¯ä»¥å€ŸåŠ©åŸç”Ÿ <em>JS</em> çš„ <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController">AbortController</a> ç±»å®ç°ï¼Œè€Œä¸” <a target="_blank" rel="noopener" href="https://github.com/axios/axios">axios</a> è‡ª <code>v0.22.0</code> åä¹Ÿæ”¯æŒè¿™ä¸€ç‰¹æ€§ï¼Œå¾ˆæ˜¯æ–¹ä¾¿ã€‚</p>
<p>å†æŠŠ <code>request</code> å’Œ <code>newRequest</code> æ”¹é€ ä¸€ä¸‹ï¼š</p>
<details open>
<summary>js</summary>

<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">request</span> <span class="token operator">=</span> <span class="token parameter">id</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span>signal
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">cancel</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">fetch id(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">) is canceled.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> response<span class="token punctuation">,</span> cancel <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> newRequest <span class="token operator">=</span> <span class="token function">watchExpiredCallback</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> onCleanup</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> response<span class="token punctuation">,</span> cancel <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
  <span class="token function">onCleanup</span><span class="token punctuation">(</span>cancel<span class="token punctuation">)</span>
  <span class="token keyword">return</span> response
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token function">newRequest</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"from 1"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token function">newRequest</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"from 2"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token function">newRequest</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"from 3"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

</details>

<p>æ”¹é€ åçš„ <code>newRequest</code> ä»£ç é€»è¾‘æ›´ç®€æ´äº†ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="/835ff34dd8d8/code-v2.png" alt="code-v2"></p>
<p>å¯ä»¥çœ‹åˆ°å‰ä¸¤æ¬¡è¯·æ±‚å·²ç»è¢«å–æ¶ˆå•¦ï¼Œå®Œç¾ï¼</p>
<blockquote>
<p>2024&#x2F;08&#x2F;22 æ›´æ–°ï¼šå®é™…å¼€å‘ä¸­å‘ç°å‚æ•°ä½¿ç”¨èµ·æ¥å¾ˆå¥‡æ€ªï¼Œæ”¹æˆä¸‹é¢è¿™ç§å‚æ•°ç»“æ„æ›´åŠ æ–¹ä¾¿ä¸€ç‚¹ã€‚</p>
</blockquote>
<details open>
<summary>js</summary>

<pre class="language-diff" data-language="diff"><code class="language-diff">function watchExpiredCallback(callback) &#123;
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> let cleanup
</span><span class="token prefix unchanged"> </span><span class="token line"> const onCleanup = fn => &#123;
</span><span class="token prefix unchanged"> </span><span class="token line">   cleanup = fn
</span><span class="token prefix unchanged"> </span><span class="token line"> &#125;
</span><span class="token prefix unchanged"> </span><span class="token line"> return function (...args) &#123;
</span><span class="token prefix unchanged"> </span><span class="token line">   cleanup?.()
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   return callback.apply(this, [args, onCleanup])
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   return callback.apply(this, [onCleanup, ...args])
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &#125;
</span></span>&#125;</code></pre>

</details>

<p>ç”¨èµ·æ¥å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<details open>
<summary>js</summary>

<pre class="language-diff" data-language="diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> const newRequest = watchExpiredCallback(function (args, onCleanup) &#123;
</span><span class="token prefix deleted">-</span><span class="token line"> const id = args[0]
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const newRequest = watchExpiredCallback(function (onCleanup, id) &#123;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   const &#123; response, cancel &#125; = request(id)
</span><span class="token prefix unchanged"> </span><span class="token line">   onCleanup(cancel)
</span><span class="token prefix unchanged"> </span><span class="token line">   return response
</span><span class="token prefix unchanged"> </span><span class="token line"> &#125;)</span></span></code></pre>

</details>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/3b6191ac9bf6.html" title="Omit | Pick | PickAndOmit"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">ä¸Šä¸€é¡µ: Omit | Pick | PickAndOmit</span></a><a class="button is-default" href="/6d3a4b0222af.html" title="React + Antd æ­å»ºä¸€ä¸ªè¯äº‘åœ¨çº¿ç”Ÿæˆç½‘ç«™"><span class="has-text-weight-semibold">ä¸‹ä¸€é¡µ: React + Antd æ­å»ºä¸€ä¸ªè¯äº‘åœ¨çº¿ç”Ÿæˆç½‘ç«™</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="showlotus/showlotus" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- TODO é…ç½®ä¸ªäººç½‘ç«™é“¾æ¥--><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/showlotus"><i class="iconfont icon-github"></i></a><!-- Gitee--><!-- Ins--><!-- RSS--><!-- çŸ¥ä¹--><!-- é¢†è‹±--><!-- è„¸ä¹¦--></section><p><span>Copyright Â©</span><span> showlotus 2026</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@2.1.4/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js"></script><script src="/js/clipboard_use.js"></script><script src="/js/codepen.io.js"></script></body></html>