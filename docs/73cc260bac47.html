<!DOCTYPE html><html class="appearance-light" lang="zh-CN"><head><meta charset="UTF-8"><title>å¼€å‘ä¸€ä¸ª Prettier æ’ä»¶ï¼šå…¨å±€æ›¿æ¢èµ„æºå¼•å…¥è·¯å¾„ &lt;W15&gt;</title><meta name="description" content="I hope one day, everyone is using my program."><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="


æœ€è¿‘åœ¨è¿ç§»é¡¹ç›®ï¼Œå¯¹äºä¸€äº›èµ„æºçš„å¼•ç”¨è·¯å¾„ï¼Œéœ€è¦æ¢æˆä¸€ä¸ªæ–°çš„è·¯å¾„ã€‚è¿˜å¥½ä¹‹å‰éƒ½æŠŠèµ„æºå¼•ç”¨çš„æ–¹å¼ï¼Œæ”¹æˆä»¥ @/.. åˆ«åå¼•å…¥çš„æ–¹å¼ï¼Œæ›¿æ¢èµ·æ¥è¿˜ç®—ç®€å•ã€‚å…ˆæŠŠæ–°æ—§è·¯å¾„åˆ—å‡ºæ¥ï¼Œç„¶åç”¨ VSCode çš„å…¨å±€æ›¿æ¢ï¼Œå› ä¸ºå°±åªæœ‰ä¸‰ç§ï¼ŒCV ä¸‰æ¬¡å°±å¥½äº†ã€‚è¿™ç§æ–¹æ³•ï¼Œåœ¨å½“æ—¶æˆ‘è®¤ä¸ºæ˜¯æ¯”è¾ƒå¥½çš„äº†ï¼Œå…¶å®ä¹Ÿæœ‰æ‰“ç®—æ•´ä¸ªä»€ä¹ˆè„šæœ¬å•¥çš„ï¼Œä½†ä¸çŸ¥é“ä»ä½•åšèµ·ã€‚ç›´åˆ°å½“å¤©æ™šäº›æ—¶å€™ï¼Œçœ‹åˆ°äº†ç¥å…‰å¤§ä½¬æœ€æ–°å‘å¸ƒçš„ä¸€ç¯‡æ–‡ç« ï¼šå†™ä¸€ä¸ªåŒäº‹è§äº†ä¼šæ‰“ä½ çš„ Prettier æ’ä»¶ã€‚ç›´æ¥å¯¹æˆ‘é†é†çŒé¡¶ï¼Œè¿™ä¸å°±æ˜¯æˆ‘æƒ³è¦çš„å·¥å…·å˜›ï¼äºæ˜¯å°±æ‰“ç®—å†™ä¸€ä¸ª prettier æ’ä»¶ï¼Œç»Ÿä¸€æ ¼å¼åŒ–è·¯å¾„ï¼Œæƒ³æ³•æœ‰äº†ï¼Œå¼€å¹²ï¼




æœ€ç»ˆçš„æ•ˆæœå¦‚ä¸Šï¼Œç‚¹å‡»ä¿å­˜åï¼Œè‡ªåŠ¨å°† path è¿›è¡Œæ›¿æ¢ã€‚

å¯¹äºä¸€æ®µæ™®é€šçš„ import ä»£ç ï¼Œè½¬æˆ AST åï¼Œæ˜¯ä¸‹é¢è¿™æ ·ï¼š


import ä¸­çš„ path å¯¹åº”çš„å°±.."><meta name="generator" content="Hexo 5.4.2"></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">showlotus's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">å¼€å‘ä¸€ä¸ª Prettier æ’ä»¶ï¼šå…¨å±€æ›¿æ¢èµ„æºå¼•å…¥è·¯å¾„ &lt;W15&gt;</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">ç‚¹å‡»è¿”å›é¡¶éƒ¨</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile is-hidden"></div><div class="column is-9"><header class="my-4"><a href="/tags/AST"><i class="tag post-item-tag">AST</i></a><a href="/tags/Babel"><i class="tag post-item-tag">Babel</i></a><a href="/tags/Prettier"><i class="tag post-item-tag">Prettier</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">å¼€å‘ä¸€ä¸ª Prettier æ’ä»¶ï¼šå…¨å±€æ›¿æ¢èµ„æºå¼•å…¥è·¯å¾„ &lt;W15&gt;</h1><time class="has-text-grey custom-date-font" datetime="2022-12-10T14:35:46.000Z">2022/12/10 14:35</time><article class="mt-2 post-content"><img src="/73cc260bac47/banner.jpg" class="">

<blockquote>
<p>æœ€è¿‘åœ¨è¿ç§»é¡¹ç›®ï¼Œå¯¹äºä¸€äº›èµ„æºçš„å¼•ç”¨è·¯å¾„ï¼Œéœ€è¦æ¢æˆä¸€ä¸ªæ–°çš„è·¯å¾„ã€‚è¿˜å¥½ä¹‹å‰éƒ½æŠŠèµ„æºå¼•ç”¨çš„æ–¹å¼ï¼Œæ”¹æˆä»¥ <code>@/..</code> åˆ«åå¼•å…¥çš„æ–¹å¼ï¼Œæ›¿æ¢èµ·æ¥è¿˜ç®—ç®€å•ã€‚å…ˆæŠŠæ–°æ—§è·¯å¾„åˆ—å‡ºæ¥ï¼Œç„¶åç”¨ <em>VSCode</em> çš„å…¨å±€æ›¿æ¢ï¼Œå› ä¸ºå°±åªæœ‰ä¸‰ç§ï¼Œ<em>CV</em> ä¸‰æ¬¡å°±å¥½äº†ã€‚è¿™ç§æ–¹æ³•ï¼Œåœ¨å½“æ—¶æˆ‘è®¤ä¸ºæ˜¯æ¯”è¾ƒå¥½çš„äº†ï¼Œå…¶å®ä¹Ÿæœ‰æ‰“ç®—æ•´ä¸ªä»€ä¹ˆè„šæœ¬å•¥çš„ï¼Œä½†ä¸çŸ¥é“ä»ä½•åšèµ·ã€‚ç›´åˆ°å½“å¤©æ™šäº›æ—¶å€™ï¼Œçœ‹åˆ°äº†ç¥å…‰å¤§ä½¬æœ€æ–°å‘å¸ƒçš„ä¸€ç¯‡æ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/w1ms6ltvPTU5Hes6o7AJYQ">å†™ä¸€ä¸ªåŒäº‹è§äº†ä¼šæ‰“ä½ çš„ Prettier æ’ä»¶</a>ã€‚ç›´æ¥å¯¹æˆ‘é†é†çŒé¡¶ï¼Œè¿™ä¸å°±æ˜¯æˆ‘æƒ³è¦çš„å·¥å…·å˜›ï¼äºæ˜¯å°±æ‰“ç®—å†™ä¸€ä¸ª <em>prettier</em> æ’ä»¶ï¼Œç»Ÿä¸€æ ¼å¼åŒ–è·¯å¾„ï¼Œæƒ³æ³•æœ‰äº†ï¼Œå¼€å¹²ï¼</p>
</blockquote>
<img src="/73cc260bac47/result.gif" class="">

<blockquote>
<p>æœ€ç»ˆçš„æ•ˆæœå¦‚ä¸Šï¼Œç‚¹å‡»ä¿å­˜åï¼Œè‡ªåŠ¨å°† <code>path</code> è¿›è¡Œæ›¿æ¢ã€‚</p>
</blockquote>
<p>å¯¹äºä¸€æ®µæ™®é€šçš„ <code>import</code> ä»£ç ï¼Œè½¬æˆ <code>AST</code> åï¼Œæ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<img src="/73cc260bac47/1.png" class="">

<p><code>import</code> ä¸­çš„ <code>path</code> å¯¹åº”çš„å°±æ˜¯æ¯ä¸ª <code>ImportDeclaration</code> èŠ‚ç‚¹ä¸­çš„ <code>source.value</code>ã€‚</p>
<p>åªéœ€è¦æŠŠæ¯ä¸ªèŠ‚ç‚¹ä¸­çš„ <code>source.value</code> æŒ‰ç…§æŒ‡å®šçš„æ›¿æ¢è§„åˆ™ç»™æ›¿æ¢ä¸€éï¼Œç„¶åå†ç”¨æ›¿æ¢åçš„ <code>AST</code> å»ç”Ÿæˆä»£ç ï¼Œè¿™æ ·å°±å¤§åŠŸå‘Šæˆäº†ã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿå®Œæ•´çš„ <code>preprocess</code> å¦‚ä¸‹ï¼š</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">myPreprocessor</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"jsx"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">"module"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> importNodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token function">ImportDeclaration</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      importNodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">clone</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span>
      path<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token comment">// å†™å…¥è‡ªå®šä¹‰æ›¿æ¢è§„åˆ™ï¼Œç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„è®°å½•</span>
  <span class="token comment">// æ•°ç»„ç¬¬ä¸€é¡¹ä¸ºåŒ¹é…è§„åˆ™ï¼Œç¬¬äºŒé¡¹ä¸ºæ›¿æ¢åçš„è·¯å¾„</span>
  <span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">"^@/packages/mixins/"</span><span class="token punctuation">,</span> <span class="token string">"@/mixins/"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">"^@/libs/assist"</span><span class="token punctuation">,</span> <span class="token string">"@/utils/assist"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">"^@/views/editor/editor-props"</span><span class="token punctuation">,</span> <span class="token string">"@/utils/editor-props"</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>

  rules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">rule</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    rule<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>rule<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  importNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>rule<span class="token punctuation">,</span> t<span class="token punctuation">]</span> <span class="token keyword">of</span> rules<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>rule<span class="token punctuation">,</span> t<span class="token punctuation">)</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> newAST <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"Program"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> importNodes
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> newCode <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>newAST<span class="token punctuation">)</span><span class="token punctuation">.</span>code <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">retainLines</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>code

  <span class="token keyword">return</span> newCode
<span class="token punctuation">&#125;</span></code></pre>

<p>çœ‹çœ‹æ•ˆæœå¦‚ä½•ã€‚</p>
<img src="/73cc260bac47/2.gif" class="">

<p>å’¦~ ä¸å¯¹åŠ²å•Šï¼æ€ä¹ˆæŠŠ <em>17</em> è¡Œçš„æ³¨é‡Šï¼Œåˆé‡æ–°ç”Ÿæˆäº†ä¸€æ¬¡ ğŸ˜¦ã€‚æ’æŸ¥äº†ä¸€ä¸‹ï¼Œè²Œä¼¼æ˜¯å› ä¸º <code>newAST</code> ä¸­æœ€åä¸€ä¸ª <code>ImportDeclaration</code> èŠ‚ç‚¹ä¸­æœ‰ä¸€ä¸ª <code>trailingComments</code> èŠ‚ç‚¹ï¼ˆå³ <code>// this is test</code>ï¼‰ï¼Œè€Œ <code>ast</code> ä¸­ç¬¬ä¸€ä¸ª <code>FunctionDeclaration</code> èŠ‚ç‚¹çš„ <code>leadingComments</code> ä¸­åŒæ ·ä¹Ÿæœ‰è¿™ä¸ªæ³¨é‡ŠèŠ‚ç‚¹ï¼Œå¯¼è‡´å°±ç”Ÿæˆäº†ä¸¤æ¬¡ï¼Œé‚£ä¹ˆæŠŠæœ€åä¸€ä¸ª <code>ImportDeclaration</code> èŠ‚ç‚¹ä¸­çš„ <code>trailingComments</code> æ¸…ç©ºæ˜¯ä¸æ˜¯å°±è¡Œäº†ï¼Ÿå…ˆè¯•ä¸€ä¸‹ã€‚</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">importNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>rule<span class="token punctuation">,</span> t<span class="token punctuation">]</span> <span class="token keyword">of</span> rules<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>rule<span class="token punctuation">,</span> t<span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// æ¸…ç©ºæœ€åä¸€ä¸ª import èŠ‚ç‚¹çš„ trailingComments</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> importNodes<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    node<span class="token punctuation">.</span>trailingComments <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

<img src="/73cc260bac47/3.gif" class="">

<p>çœ‹æ ·å­ï¼Œæ²¡å•¥é—®é¢˜ã€‚ä¸å¦¨å†çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p>
<img src="/73cc260bac47/4.gif" class="">

<p>è¿™æ¬¡åˆæŠŠ <code>import</code> ä»£ç é—´çš„æ³¨é‡Šé‡æ–°ç”Ÿæˆäº†ä¸€ä»½ã€‚(âŠ™ï¹âŠ™) æ€»ä¸èƒ½å»æ¯”è¾ƒæ¯ä¸ªæ³¨é‡ŠèŠ‚ç‚¹ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰ç›¸åŒçš„ï¼Œç„¶åå†å»é‡å§ ğŸ¤¡ã€‚è½¬å¿µä¸€æƒ³ï¼Œå¯ä»¥å»çœ‹çœ‹ <code>prettier-plugin-sort-imports</code> çš„æºç å•Šï¼Œçœ‹çœ‹äººå®¶æ€ä¹ˆå¤„ç†çš„ã€‚<em>Get ~</em></p>
<p>æºç æ˜¯ç”¨ <em>TS</em> å†™çš„ï¼Œè™½ç„¶æ²¡å†™è¿‡ <em>TS</em> ï¼Œä½†æ˜¯å¤§è‡´æ€è·¯è¿˜æ˜¯èƒ½çœ‹æ‡‚çš„ï¼Œå­å­å“§å“§ä¹Ÿç®—çœ‹æ˜ç™½äº†ä¸ªå¤§æ¦‚ã€‚æ€»ä½“ä¸‹æ¥ï¼Œå¤„ç†æ€è·¯å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li>å…ˆä» <code>importNodes</code> ä¸­è·å–æ‰€æœ‰æ³¨é‡ŠèŠ‚ç‚¹ <code>allCommentsFromImports</code>ã€‚</li>
<li>ç„¶åä»æºä»£ç ç‰‡æ®µä¸­ï¼Œç§»é™¤ <code>importNodes</code> ä¸ <code>allCommentsFromImports</code>ï¼Œå¾—åˆ°ä¸€ä»½å¹²å‡€çš„æºä»£ç  <code>codeWithoutImportsAndInterpreter</code>ã€‚</li>
<li>æœ€åï¼Œç”¨ <code>importNodes</code> ç”Ÿæˆçš„ <code>AST</code> é‡æ–°ç”Ÿæˆçš„ä»£ç  + <code>codeWithoutImportsAndInterpreter</code>ã€‚</li>
</ol>
<p>å¤§è‡´æ€è·¯æœ‰äº†ï¼Œåˆä» <code>prettier-plugin-sort-imports</code> é‚£é‡Œå€Ÿé‰´äº†ä¸¤ä¸ªæ–¹æ³•ï¼š<code>getAllCommentsFromNodes</code>ï¼ˆè·å– <code>importNodes</code> ä¸­çš„æ‰€æœ‰æ³¨é‡Šï¼‰ã€<code>removeNodesFromOriginalCode</code>ï¼ˆä»æºä»£ç ç‰‡æ®µä¸­ç§»é™¤æŸäº›èŠ‚ç‚¹ï¼‰ã€‚</p>
<p>å®Œæ•´çš„ <code>preprocess</code> å¦‚ä¸‹ï¼š</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">myPreprocessor</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"jsx"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">"module"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> importNodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token function">ImportDeclaration</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      importNodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">clone</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">"^@/packages/mixins/"</span><span class="token punctuation">,</span> <span class="token string">"@/mixins/"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">"^@/libs/assist"</span><span class="token punctuation">,</span> <span class="token string">"@/utils/assist"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">"^@/views/editor/editor-props"</span><span class="token punctuation">,</span> <span class="token string">"@/utils/editor-props"</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
  rules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">rule</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    rule<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>rule<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  importNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>rule<span class="token punctuation">,</span> t<span class="token punctuation">]</span> <span class="token keyword">of</span> rules<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>rule<span class="token punctuation">,</span> t<span class="token punctuation">)</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> importNodes<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      node<span class="token punctuation">.</span>trailingComments <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> newAST <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"Program"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> importNodes
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> allCommentsFromImports <span class="token operator">=</span> <span class="token function">getAllCommentsFromNodes</span><span class="token punctuation">(</span>importNodes<span class="token punctuation">)</span>

  <span class="token keyword">const</span> nodesToRemoveFromCode <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>importNodes<span class="token punctuation">,</span> <span class="token operator">...</span>allCommentsFromImports<span class="token punctuation">]</span>
  <span class="token keyword">const</span> codeWithoutImportsAndInterpreter <span class="token operator">=</span> <span class="token function">removeNodesFromOriginalCode</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> nodesToRemoveFromCode<span class="token punctuation">)</span>

  <span class="token keyword">const</span> newCode <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>newAST<span class="token punctuation">)</span><span class="token punctuation">.</span>code <span class="token operator">+</span> codeWithoutImportsAndInterpreter
  <span class="token keyword">return</span> newCode
<span class="token punctuation">&#125;</span></code></pre>

<p>å†æ¥çœ‹çœ‹æ•ˆæœå¦‚ä½•ã€‚å®Œç¾ï¼</p>
<img src="/73cc260bac47/5.gif" class="">

<p>æœ€åï¼Œä¸ºäº†è®©å®ƒçœ‹èµ·æ¥æ›´åƒä¸€ä¸ªæ’ä»¶ï¼Œæˆ‘æŠŠè·¯å¾„æ›¿æ¢è§„åˆ™æŒªåˆ°äº† <code>prettier</code> çš„é…ç½®ä¸­ï¼š</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// .prettierrc.js</span>
<span class="token keyword">const</span> myPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./plugins/index"</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">tabWidth</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">arrowParens</span><span class="token operator">:</span> <span class="token string">"avoid"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">singleQuote</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">semi</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">trailingComma</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">pathReplaceRules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"^@/packages/mixins/"</span><span class="token punctuation">,</span> <span class="token string">"@/mixins/"</span><span class="token punctuation">,</span> <span class="token string">"^@/libs/assist"</span><span class="token punctuation">,</span> <span class="token string">"@/utils/assist"</span><span class="token punctuation">,</span> <span class="token string">"^@/views/editor/editor-props"</span><span class="token punctuation">,</span> <span class="token string">"@/utils/editor-props"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>myPlugin<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>åŒæ—¶éœ€è¦åœ¨æ’ä»¶ä¸­ï¼Œæ·»åŠ è‡ªå®šä¹‰çš„é…ç½®é¡¹ï¼Œä¸ç„¶ <em>prettier</em> ä¼šå¿½ç•¥è¿™ä¸ªé…ç½®ã€‚</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// plugin/index.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">parsers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">babel</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token operator">...</span>babelParsers<span class="token punctuation">.</span>babel<span class="token punctuation">,</span>
      <span class="token literal-property property">preprocess</span><span class="token operator">:</span> myPreprocessor
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">pathReplaceRules</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"path"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">category</span><span class="token operator">:</span> <span class="token string">"Global"</span><span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">"Provide an rule to replace imports."</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>åœ¨ <em>prettier</em> å®˜æ–¹æ–‡æ¡£é‡Œç¿»äº†å¥½ä¹…ï¼Œä¹Ÿæ²¡æ‰¾åˆ°å¦‚ä½•å°†é…ç½®é…æˆä¸€ä¸ªäºŒç»´æ•°ç»„çš„å½¢å¼ï¼Œè²Œä¼¼åªèƒ½æ˜¯ä¸€ç»´å­—ç¬¦ä¸²æ•°ç»„çš„å½¢å¼ã€‚ä¸è¿‡ï¼Œå¥½åœ¨å¯ä»¥æŠŠé…ç½®æ•°ç»„æŒ‰æ¯ä¸¤ä¸ªè¿›è¡Œåˆ†å—ï¼Œæ ¼å¼åŒ–æˆä¸‹é¢è¿™æ ·ï¼š</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">"^@/packages/mixins/"</span><span class="token punctuation">,</span> <span class="token string">"@/mixins/"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">"^@/libs/assist"</span><span class="token punctuation">,</span> <span class="token string">"@/utils/assist"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">"^@/views/editor/editor-props"</span><span class="token punctuation">,</span> <span class="token string">"@/utils/editor-props"</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span></code></pre>

<p>ä¸€ä¸ªç®€å•çš„ç®—æ³•é¢˜ï¼šã€Šæ•°ç»„åˆ†å—ã€‹ ğŸ˜</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">arrayChunk</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> size</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> curr</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">[</span>res<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        res<span class="token punctuation">[</span>res<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>curr<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>curr<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">return</span> res
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>è™½ç„¶çœ‹èµ·æ¥å¾ˆæ€ªï¼Œä½†æ˜¯æ•´ä½“è¿˜æ˜¯ä¸é”™çš„ï¼Œä½¿ç”¨åï¼Œå¼€å‘æ•ˆç‡å’”å’”å¾€ä¸Šå‡ï¼ğŸ˜œ</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/95404f938c1c.html" title="ç»™ ViewDesign åŠ ä¸ªä¸»é¢˜æ¢è‚¤ğŸ’– &lt;W16&gt;"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">ä¸Šä¸€é¡µ: ç»™ ViewDesign åŠ ä¸ªä¸»é¢˜æ¢è‚¤ğŸ’– &lt;W16&gt;</span></a><a class="button is-default" href="/c57af76d99fd.html" title="ç”¨ npm-pack-all æ‰¹é‡ç”Ÿæˆ .tgz æ–‡ä»¶ &lt;W14&gt;"><span class="has-text-weight-semibold">ä¸‹ä¸€é¡µ: ç”¨ npm-pack-all æ‰¹é‡ç”Ÿæˆ .tgz æ–‡ä»¶ &lt;W14&gt;</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="showlotus/showlotus" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- TODO é…ç½®ä¸ªäººç½‘ç«™é“¾æ¥--><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/showlotus"><i class="iconfont icon-github"></i></a><!-- Gitee--><!-- Ins--><!-- RSS--><!-- çŸ¥ä¹--><!-- é¢†è‹±--><!-- è„¸ä¹¦--></section><p><span>Copyright Â©</span><span> showlotus 2026</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@2.1.4/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js"></script><script src="/js/clipboard_use.js"></script><script src="/js/codepen.io.js"></script></body></html>