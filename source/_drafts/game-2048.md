---
title: 小游戏系列之：2048
categories:
  - 日常
tags:
  - Vue
  - 小游戏
  - 草稿
mathjax: false
date: 2023-07-22 18:28:05
---

> 之前有一个想法：想把自己玩过的小游戏，都用 _JS_ 实现出来。陆陆续续也写过一些小游戏，比如贪吃蛇、俄罗斯方块、扫雷等等。这些有些用 _TS_ 实现的，有些用 _Vue_ 实现的，使用 _Vue_ 已经两年多了，于是就想利用 _Vue_ 语言的优势，用一个 _SFC_ （单文件组件）去实现一个小游戏，看看如果实现起来会是个什么样子，并且打算做成一个系列。刚好昨天逛超市的时候，看到一个还原数字位置的拼图玩具，当时就想这个如果用 _JS_ 该如何实现。想了想，似乎也不是很难。类似这种的游戏还有很多，还是想做一个不失趣味性的小游戏，有逻辑思维的，这种体力游戏没啥意思。然后，灵光一闪，那就做一个 2048 小游戏吧，规则简单还不失趣味性，要想玩得好关键得动动脑子。想法有了，那就来吧！！！

#### 游戏规则

先从维基百科上重新了解一下这个的游戏规则：

{% asset_img rule.png %}

提取一下关键信息：

- 需要一个 `4x4` 的方格；
- 随机出现的数字是 `2` 或 `4`；
- 可以向四个方向滑动，且滑动时，相同数字的方块会被合并；
- 方格内所有数字被填满，且无法通过滑动再产生合并时，游戏结束；
- 出现 `2048` 时，游戏胜利。

#### 方案设计

1. 首先，要画一个 `4x4` 的方格，每个方格只是一个空槽，可以在对应位置生成一个数字然后填充它。实现 `16` 个空槽的方式有很多，可以用 `16` 个 _Div_ 元素去实现，也可以用一个元素 + `box-shadow`，这里用的后者：伪元素 `::before` + `box-shadow`，根本不需要新增多余的元素就可以实现。因为空槽有圆角半径，使用 `background` 的话，不容易实现，而使用阴影的话，则会容易一点。不过在调整阴影位置时，需要一个一个排，会费点时间。这就需要自己权衡了，选择：`多元素 + 样式容易`，还是 `单元素 + 样式复杂`；
2. 因为数字在空槽之上，所以要确保生成数字元素时，要与下方的空槽位置对应上。对 `16` 个数字元素（最多会有 `16` 个）进行 `4x4` 的布局，可以使用 `display: grid` 去实现，快速且方便；
3. 数字可以根据滑动的方向进行移动，PC 端使用上下左右按键，移动端使用上下左右滑动的方式。PC 端可以监听全局 `keydown` 事件，移动端使用工具库 [hammerjs](https://hammerjs.github.io/)，监听四个方向的滑动；
4. 滑动时，有动画效果，可以借助 _Vue_ 提供的状态过渡，也可以使用第三方的动画库。这个用了一个动画库 [@formkit/auto-animate](https://auto-animate.formkit.com/)；
5. 相同数字的碰撞，每个数字只会碰撞一次且同时进行。比如第一排对应的数字分别是：`2, 2, 4, 4`，操作是：向右滑动，那么碰撞后，第一排的数字分别是：`空, 空, 4, 8`，而不是：`空, 空, 8, 4`。也就是说，在进行碰撞合并监测时，如果当前数字 _A_ 和在目标方向上的下一个数字 _B_ 相同，那么就进行合并，即把 _A_ 累加到 _B_ 上，且跳过对 _B_ 的监测，对 _B_ 的下一个数字 _C_ 进行监测。这样就能保证，每个数字在一次操作中有且只会合并一次。因为要对同行或者同列进行碰撞监测，所以把数据结构设计成一个二维数组最好，方便合并。
6. 每轮操作结束后，会在空余的地方，随机生成一个数字：`2` 或 `4`。如果当前操作没有发生合并，且无法移动任意一个数字，则判定该轮操作为一次无效操作，不会生成新的随机数字。关于游戏是否结束的判断，如果当前最大数字是 `2048` 则游戏胜利；如果一轮操作后，键盘上没有空余的地方，且不存在可以合并的数字，则游戏结束。
7. 因为不同数字对应的颜色和字体大小略有不同，打算去游戏里取色。于是就去玩了一下，奈何有点菜，根本玩不到 `2048`。好在 <font color="pink" style="font-weight: bold;"><sup>♥</sup>小丸子<sup>♥</sup></font> 同学技高一筹，成功玩到了 `2048`，让我有机会取到了色，感谢(づ￣ 3 ￣)づ。

仔细玩过几局后发现，整个界面其实是有两层的：第一层是背景，第二层是数字方块。而且背景

{% asset_img background.png %}

{% asset_img problem.gif %}

{% asset_img result.gif %}
